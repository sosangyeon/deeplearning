Abstract
3D 복셀 cnn과 pointnet 기반 집합 추상ㅇ화를 긴밀하게 통합하여 차별적인 포인트 클라우드 기능을 학습한다.
voxel cnn에 의해 생성된 고품질 3d proposal를 감안할 때, polgrid pooling은 여러 수용 필드를 가진
키포인트 세트 추상화를 통해 키포인트에서 rol-그리드 포인트까지 제안서별 기능을 추상화하도록 제안된다.
기존의 풀링 작업과 비교했을 때, rol-grid 특징점은 객체 신뢰도와 위치를 정확하게 추정하기 위해 훨씬 더 풍부한 컨텍스트 정보를 인코딩한다.

1. Introduction
Lidar 센서는 3D 장면 인식 및 이해를 위한 중요한 단서를 제공하는 희박하고 불규칙한 포인트 클라우드로 3D 장면 정보를 
3D 검출 방법은 포인트 클라우드 표현 측면에서 두 가지 범주, 그리드 기반 방법과 포인트 기반 방법으로 분류할 수 있다.

그리드 기반 방법
불규칙한 포인트 클라우드를 3D 복셀 또는 2D bev과 같은 규칙적인 표현으로 변환하며, 이는 3D 또는 2D cnn에서 효율적으로
처리하여 3D 감지를 위한 포인트 기능을 학습할 수 있다.

포인트 기반 방법
3D 감지를 위해 원시 포인트 클라우드에서 판별 특징을 직접 추출한다.

일반적으로 그리드 기반 방법은 계산 효율성이 높지만 불가피한 정보 손실로 인해 세분화된 지역화 정확도가 저하되는 반면,
포인트 기반 방법은 계산 비용이 높지만 포인트 세트 추상화에 의해 더 큰 수용 필드를 쉽게 얻을 수 있다.
pv-rcnn은 두 가지 유형의 방법 중 장점을 합하여 3D 검출 성능을 향상시켰다.

pv-rcnn의 원리는 복셀 기반 작업이 다중 스케일 기능 표현을 효율적으로 인코딩하고, pointnet 기반 집합 추상화 작업은
유연한 수용 필드로 정확한 위치 정보를 보존한다.
이 두 가지 유형의 기능 학습 프레임워크의 통합이 정확하고 세분화된 상자 미세 조정을 위해 더 차별적인 기능을 학습하는데
도움이 될 수 있다고 주장한다.

직관적인 솔루션은 각 3D proposal 내에서 여러 그리드 포인트를 균일하게 샘플링하고 세트 추상화를 채택하여 
proposal 개선을 위해 이러한 그리드 포인트를 둘러싼 3D 복셀 단위 기능을 집계하는 것이다.
-> 단점 : 복셀의 수와 그리드 점의 수가 모두 크기 때문에 메모리 사용량이 매우 많다.

따라서 두 가지 유형의 학습 네트워크를 더 잘 통합하기 위해 
1. 복셀-키포인트 장면 인코딩 단계
2. 키포인트-그리드 rol 기능 추상화 단계
2단계 전략을 제안한다.

1) 복셀-키포인트 장면 인코딩 단계
3D 복셀 cnn이 채택되어 전체 장면을 인코딩하는데 너무 많은 복셀이 필요한 문제를 완화하기 위해 fps에 의해 작은 키포인트 집합이
선택되어 복셀별 기능의 전체 3D 정보를 요약한다.
각 키포인트의 특징은 다중 스케일 포인트 클라우드 정보를 요약하기 위해 pointnet 기반 집합 추상화를 통해 인접한 복셀 단위 기능을 그룹화하여 집계된다.
-> 장면을 복셀 단위로 나누고 이 중에서 중요한 키포인트들만 선택
이 키포인트들은 장면의 중요한 부분을 대표하며, 각각의 키포인트가 그 주변 복셀들의 정보를 요약하여 전체 3D 정보를 압축하는 역할
하나의 고정된 크기에서만 주변 정보를 수집하는 것이 아니라, 다양한 크기(스케일)에서 주변 점들을 살펴본다.
더 작은 범위의 세부 정보부터 더 넓은 범위의 전반적인 정보까지를 효과적으로 포착할 수 있다.
키포인트는 자신을 중심으로 인접한 복셀들을 그룹으로 묶는다. 
그 복셀들 각각이 가지고 있는 정보를 하나의 집합으로 모으고, 이를 바탕으로 키포인트의 특징을 요약한다.
이러한 방식으로, 전체 장면은 연관된 다중 스케일 기능이 있는 소수의 키포인트에 의해 효과적이고 효율적인
인코딩이 될 수 있다.

2) 키포인트-그리드 rol 추상화 단계
그리드 포인트 위치가 있는 각 박스 제안이 주어지면 rol-그리드 풀링 모듈이 제안되며, 여기서 각 그리드 포인트에 대해
여러 반경을 가진 키포인트 세트 추상화 계층이 채택되어 다중 스케일 컨텍스트를 가진 키포인트의 기능을 집계한다.
그런 다음 모든 그리트 포인트의 집계된 피쳐를 후속 제안서 미세 조정에 공동으로 사용할 수 있다.
RoI(Region of Interest) : 특정 물체가 있을 것으로 예상되는 영역
그리드 포인트 : 박스 내부에 그리드 형태로 점들을 놓는다. 이 그리드 포인트들은 박스 내에서 중요한 지점을 나타내며, 
각 포인트는 그 위치의 특찡을 나타낼 정보를 모으게 된다.
RoI-그리드 풀링 모듈은 각 그리드 포인트에 대해 주변 키퐁인트들의 특징을 추출하고 요약하는 과정이다.
여기서 RoI-그리드 풀링은 다중 스케일 컨텍스트를 활용하여 풍부한 정보를 요약한다.
마지막으로, 그리드 포인트들에서 요약된 피처들은 박스 제안의 미세 조정에 사용된다. 즉, 처음에 제안된 박스는 대략적인 
물체 위치일 수 있지만, 그리드 포인트에서 모든 피처들을 바탕으로 더욱 정확하게 박스의 위치와 크길를 조정할 수 있다.

contribution
1) 3D 포인트 클라우드 기능 학습을 위해 복셀 기반 방법과 포인트 기반 방법을 모두 효과적으로 활용하여 관리 가능한 
메모리 소비로 3D 객체 감지 성능을 향상시키는 pv-rcnn 프레임워크를 제안한다.
2) 전체 장면의 다중 스케일 복셀 기능을 복셀 세트 추상화 계층에 의해 작은 키포인트 세트로 인코딩하는 voxel-keypoint 장면 인코딩 체계를 제안한다.
3) 각 제안서에서 그리드 포인트에 대한 다중 스케일 rol 기능 추상화 계층을 제안하며, 이는 정확한 상자 미세 조정 및 
신뢰도 예측을 위해 여러 수용 필드가 있는 장면에서 더 풍부한 컨텍스트 정보를 집계한다.

2. Related Work
3D Object Detection with Grid-based Methods
포인트 클라우드의 불규칙한 데이터 형식을 다루기 위해 대부분의 기존 작업은 포인트 클라우드를 일반 그리드에 투영하여 
2D 또는 3D cnn에서 처리한다. 
선구적인 작업인 mv3d는 포인트 클라우드를 2d bev 그리드에 투영하고 3D 바운딩 박스를 생성하기 위해 사전 정의된 3D 앵커를
많이 배치한다.
일부 다른 작업은 포인트 클라우드를 3D cnn에서 처리할 3d 복셀로 나누고, 효율적인 3d 복셀 처리를 위해 3d 희소 컨볼루션을 도입한다.
이러한 그리드 기반 방법은 일반적으로 정확한 3d 제안서 생성에 효율적이지만 수용 필드는 커널 크기에 의해 제한된다.

3D Object Detection with Point-based Methods
pointnet은 먼저 2d 이미지 바운딩 박스를 기반으로 잘린 포인트 클라우드에서 3d 감지를 위해 pointnet를 적용할 것을 제안한다.
pointrcnn은 포인트 클라우드만을 사용한 3d 검출을 위해 2d 이미지 대신 전체 포인트 클라우드에서 직접 3d 제안서를 생성하며, 
STD는 더 나은 제안서 구체화를 위해 희소에서 조밀 전략을 제안한다.
더 나은 객체 기능 그룹화를 위한 hough 투표 전략을 제안한다.
이러한 포인트 기반 방법은 대부분 pointnet 시리즈, 유연한 수용 필드를 가능하게 하는 집합 추상화 작업을 기반으로 한다.

Representation Learning on Point Clouds
최근 포인트 클라우드에 대한 표현 학습은 포인트 클라우드 분류 및 세분화의 성능을 향상시키는데 많은 주목을 받고 있다.
3D 감지 측면에서 이전 방법은 일반적으로 2D/3D cnn으로 포인트 클라우드를 처리하기 위해 포인트 클라우드를 일반 bev
또는 3D 복셀에 투영한다.
pointnet이 원시 포인트 클라우드로부터 포인트별 특징을 직접 학습할 것을 제안하며, 여기서 집합 추상화 연산은 
2개의 서로 다른 검색 반경을 설정하여 유연한 수용 필드를 가능하게 한다.
효율적인 포인트 클라우드 기능 학습을 위해 복셀 기반 cnn과 포인트 기반 sharedmlp를 결합한다.

3. PV-RCNN for Point Cloud Object Detection
2단계 3D 감지 프레임워크인 pointvoxel-rcnn을 제안한다. 
최첨단 3D 검출 접근 방식은 희소 컨볼루션을 사용하는 3D 복셀 cnn 또는 pointnet 기반 네트워크를 백본으로 한다.
일반적으로 희소 컨볼루션을 사용하는 3D 복셀 cnn이 더 효율적이고 고품질 3D 객체 제안을 생성할 수 있는 반면, 
pointnet 기반 방법은 유연한 수용 필드로 더 정확한 컨텍스트 정보를 캡처할 수 있다.
pv-rcnn은 두 가지 유형의 네트워크의 장점을 긴밀하게 통합한다. 
pv-rcnn은 효율적인 기능 인코딩 및 제안서 생성을 위한 백본으로 희소 커볼루션이 있는 '3D 복셀 cnn'으로 구성된다. 
각 3d 개체 제안이 주어지면 장면에서 해당 기능을 효과적으로 풀링하기 위해 두 가지 새로운 작업,
1) 복셀-키포인트 장면 인코딩 2) 포인트-그리드 RoI 기능 추상화
복셀-키포인트 장면 인코딩 : 복셀-키포인트 장면 인코딩
복셀-키포인트 장면 인코딩 제안 : 제안서 신뢰도 예측 및 위치 구체화를 위해 장면 키포인트 기능을 RoI 그리드에 효과적으로 집계

3.1. 3D Voxel CNN for Efficient Feature Encoding and Proposal Generation
3d 희소 컨볼루션을 사용하는 voxel cnn은 포인트 클라우드를 희소 3d 기능 볼륨으로 효율적으로 변환하기 위해 
최첨단 3d 검출기에서 널리 사용된다. 
높은 효율성과 정확성 때문에 우리는 이를 기능 인코딩 및 3d 제안 생성을 위한 프레임워크의 중추로 채택한다.

3d 복셀 cnn. 
입력 포인트 P는 먼저 공간 해상도가 LxWxH인 작은 복셀로 나뉘며, 여기서 비어 있지 않은 복셀의 특징은 모든 내부 점의
점별 특징의 평균으로 직접 계산된다.
일반적으로 사용되는 기능은 3D 좌표와 반사율 강도이다.
네트워크는 일련의 3X3X3D 희소 컨볼루션을 사용하여 포인트 클라우드를 1x, 2x, 4x, 8x 다운샘플링된 크기의 특징 볼륨으로 점진적으로 변환한다.
각 수준에서의 이러한 희소 기능 볼륨은 복셀 별 기능 벡터의 집합으로 볼 수 있다.

3D proposal generation.
인코딩된 8x 다운샘플링된 3D 기능 볼륨을 2D bev맵으로 변환하면 앵커 기반 접근 방식에 따라 고품질 3D 제안이 생성된다.
구체적으로 말하자면, z축을 따라 3D 피처 볼륨을 쌓아 L8XW8 조류 관측 3D 피처 맵을 얻는다.
(L8 × W8은 3D 피처 볼륨을 Z축을 따라 압축해서 얻은 2D 피처 맵의 크기)
각 클래스에는 이 클래스의 평균 3D 개체 크기를 채택하는 2개의 × L 8 × W 8 3D 앵커 상자가 있으며, bev 기능 맵의 
각 픽셀에 대해 0◦ , 90◦ 방향의 두 앵커가 평가된다.

Discussions.
sota는 대부분 2단계 프레임워크를 채택한다.
이를 위해서 추가적인 제안서 개선을 위해 3D 피처 볼륨 또는 2D 맵에서 rol 특정 피처를 풀링해야 한다.
그러나 3D 복셀 cnn의 이러한 3D 기능 볼륨은 큰 한계가 있다.
1) 이러한 피처 볼륨은 일반적으로 최대 8배까지 다운샘플링되기 때문에 공간 해상도가 낮으며, 이는 입력 장면에서 
객체의 정확한 위치화를 방해한다.
2) 더 큰 공간 크기의 피처 볼륨/맵을 얻기 위해 업샘플링할 수 있더라도 일반적으로 여전히 매우 희박하다.
rolpooling/rolalign 연산에서 일반적으로 사용되는 삼선형 또는 이중선형 보간은 매우 작은 이웃에서만 피처를 추출할 수 있다.
따라서 기존의 풀링 접근 방식은 대부분 0인 기능을 얻고 2단계 미세 조정을 위해 많은 계산과 메모리를 낭비한다.
반면에, pointnet의 변형에서 제안된 집합 추상화 연산은 임의의 코기의 이웃에서 특징점을 인코딩하는 강력한 기능을 보여주었다.
따라서 정확하고 강력한 2단계 제안서 구체화를 수행하기 위해 3D 복셀 CNN을 일련의 집합 추상화 작업과 통합할 것을 제안한다.

장면 기능 복셀을 풀링하기 위해 집합 추상화 작업을 사용하는 순진한 솔루션은 장면의 다중 스케일 기능 볼륨을 rol 그리드에 직접 집계하는 것이다.
그러나 이 직관적인 전략은 단순히 많음 메모리를 차지하며 실제로 사용하기에는 비효율적이다.
예를 들어, kitti 데이터 세트의 일반적인 장면은 다운샘플링된 기능 볼륨에서 18,000개의 복셀을 생성할 수 있다. 
각 장면에 대해 100개의 상자 제안서를 사용하고 각 상자 제안서에 3x3x3 개의 그리드가 있는 경우, 
2,700x18,000 쌍별 거리와 피처 집계는 거리 임계값 설정 후에도 효율적으로 계산할 수 없다.
이 문제를 해결하기 위해 먼저 전체 장면의 서로 다른 신경 계층에 있는 복셀을 소수의 키포인트로 인코딩한 다음
키 포인트 기능을 rol 그리드에 집계하여 상자 제안서를 구체화하는 2단계 접근 방식을 제안한다.
(설명:
다중 스케일 기능 집계의 비효율성
장면의 다중 스케일 기능을 rol 그리드에 집계하는 것이 중요한데, 이는 객체가 있는 위치에 대해 정확하게 정보를 추출하기 위함이다.
제안된 해결 방법 : 2단계 접근 방식
1) 장면을 소수의 키포인트로 인코딩
먼저 장면의 복셀을 모두 처리하지 않고, 장면의 중요한 지점만을 선택하는 키포인트를 추출한다.
이는 중요한 복셀만 선택하여 소수의 중요한 키포인트로 요약하는 것이다.
2) rol 그리드에 집계
이렇게 추출된 키포인트들로부터 rol 그리드로 필요한 정보를 집계
이 단계에서 소수의 키포인트만을 다루기 때문에 계산량이 대폭 줄어든다.


3.2. Voxel-to-keypoint Scene Encoding via Voxel Set Abstraction
Keypoints Sampling
fps알고리즘을 채택하여 포인트 클라우드 P에서 적은 수의 n개의 키포인트를 샘플링한다.
이러한 전략은 키포인트가 비어 있지 않은 복셀 주위에 균일하게 분포되고 전체 장면을 대표할 수 있도록 권장한다.

Voxel Set Abstraction Module
3D cnn 기능 볼륨에서 키포인트까지 다중 스케일 의미론적 기능을 인코딩하기 위해 VSA 모듈을 제안한다. (voxel set abstraction) 
복셀별 기능 볼륨의 집계를 위해 채택된다.
키포인트의 주변 지점은 이제 pointnet에서 학습한 기능이 있는 인접 원시 점 대신 여러 수준에서 3D 복셀 CNN에 의해 인코딩된 다중 스케일 의미론적 기능이 있는 일반 복셀이다.
여기서 Nk는 k번째 레벨에서 비어 있지 않은 복셀의 수이다.
각 키포인트 pi에 대해 먼저 반경 rk 내의 k번째 수준에서 비어 있지 않은 인접 복셀을 식별하여 복셀별 기능 벡터 세트를 다음과 같이 검색한다.

Voxel Set Abstraction (VSA) Module의 목적
VSA 모듈은 3D CNN에서 추출한 다중 스케일의 복셀 기반 기능을 키포인트에 인코딩하는 작업을 수행한다.

Voxel-wise Feature Aggregation
복셀 단위로 학습된 기능을 pointnet에서 사용하는 방식처럼 요약한다.
예를 들어, 복셀 cnn에서 나온 다중 스케일 의미적 정보를 사용하여 각 키포인트에 인접한 복셀의 기능을 집계한다.
각 키포인트에 대해, 반경 rk내에 있는 이웃 복셀들을 찾아 그 복셀의 기능 벡터와 상대 좌표를 결합해 집계한다.

PointNet Block을 통한 기능 요약
이 집계된 복셀 기능을 pointnet 블록을 통해 키포인트 기능으로 변환한다.
pointnet 블록은 이웃 복셀들의 기능 벡터와 상대 좌표를 입력으로 받아, 각 키포인트의 최종 기능을 학습한다.
최종적으로 max pooling을 통해 다양한 이웃 복셀 기능 벡터들을 하나의 키포인트 기능 벡터로 요약한다.

각 키포인트에서 다양한 반경 rk를 사용해 여러 스케일에서의 컨텍스트 정보를 집계한다.
이를 통해 더 풍부한 다중 스케일 정보를 키포인트에 포함할 수 있다.
VSA 모듈은 3D CNN의 여러 레벨에서 수행되며, 각 레벨에서 얻어진 기능들을 병합하여 최종 키포인트의 기능을 생성한다.
이 기능은 복셀 CNN을 통해 학습된 기능과 pointnet을 통해 학습된 기능이 결합된 형태로, 키포인트의 3D 좌표를 기반으로 
위치 정보를 유지한 상태에서 다양한 컨텍스트를 포함한 의미적 기능을 포함하게 된다.

Predicted Keypoint Weighting
키포인트 기반의 3D 객체 검출 시스템에서, 키포인트의 중요도를 가중치로 조정하여 제안서 개선을 돕는 역할을 한다.
3D 장면을 키포인트로 인코딩한 후, 제안서 개선 과정에서 이 키포인트들이 사용된다. 하지만 모든 키포인트가 중요한 것은 
아니며, 특히 배경 영역에 속한 키포인트는 객체 검출에 큰 기여를 하지 못할 수 있다.
반면, 전경에 속한 키포인트는 제안서의 정확도를 높이는 데 더 중요한 역할을 한다.
PKW 모듈은 전경과 배경을 구분하고, 전경에 속한 키포인트에 더 높은 가중치를 부여한다.
즉, 각 키포인트의 기능을 재조정하여 중요한 키포인트는 더 큰 영향을 미치도록 하고, 덜 중요한 키포인트는 영향을 적게 미치도록 한다.
각 키포인트의 중요도는 pointcloud segmentation에서 생성된 추가적인 정보를 통해 학습된다.

3.3. Keypoint-to-grid RoI Feature Abstraction for Proposal Refinement
이전 단계에서는 전체 장면이 다중 스케일 의미론적 기능을 가진 소수의 키포인트로 요약한다.
3D 복셀 cnn에 의해 생성된 각 3D 제안서를 감안할 때, 정확하고 강력한 제안서를 구체화하기 위해 각 rol의 특징은 키포인트 특징에서
집계되어야 한다. 
다중 스케일 rol 기능 인코딩을 위한 집합 추상화 작업을 기반으로 하는 keypoint-to-grid rol 기능 추상화를 제안한다.

RoI-grid Pooling via Set Abstraction.








